10 REM *********************************
20 REM ** Listing 3.4                 **
30 REM ** SECOND PARSER               **
40 REM *********************************
44 DIM G$(50),W$(50),R%(50),LA%(50),LB%(50) 
45 Z=0: W=1: S=W: C=Z: Q=W 
48 CLS: PRINT TAB(8);"PARSER": PRINT TAB(8);"------"
49 @%=4 
50 PRINT "Input a sentence and then press RETURN:* 
60 PRINT: INPUT S$: S$=" "+S$+" ": PRINT: PRINT S$
70 H$=S$: RESTORE 
80 R=Z
90 F=Z: READ A$: IF A$="999" THEN GOTO 170 
100 IF RIGHT$(A$,W)=" " THEN A$=LEFT$(A$,LEN(A$)-W): GOTO 100 
101 REM removes trailing blanks. 
110 R = R+W 
120 FOR I=W TO LEN(A$) 
130 IF MID$(A$,I,W) = "=" THEN G$(R)=LEFT$(A$,I-W): F=W: W$(R)=RIGHT$(A$, LEN(A$)-I): I=LEN(A$) 
140   NEXT I 
150 IF F=Z THEN G$(R)=G$(R-W): W$(R)=A$
160 GOTO 90 : REM get next item
170 REM -- Implement replacement rules: 
180 F=Z: S=W
190 LS=LEN(S$) 
199 C1=Z: Q=W 
200 FOR I=Q TO LS 
210   IF MID$(S$,I,W) <> " " THEN GOTO 420 
220   I=I+W: C1=C1+w 
230   FOR J=S TO R 
240     IF MID$(S$,I,LEN(W$(J))+W) <> W$(J)+" " THEN GOTO 410 
250     C=C+W: LA%(C)=I-W: LB%(C)=LS-LEN(W$(J))-I+W
255     S$=LEFT$(S$, LA%(C))+G$(J)+RIGHT$(S$,LB%(C)) 
256     F=W: R%(C)=J: PRINT C;" ";S$
270     C2=C1+W 
280     FOR K=W TO LEN(W$(J)) 
290       IF MID$(W$(J),K,W) = " " THEN C2=C2+W 
300       NEXT K 
310     C3=Z: C4=Z: A$="" 
320     FOR K=W TO LEN(H$) 
330       A$=A$+MID$(H$,K,W) 
340       IF MID$(H$,K,W) <> " " THEN GOTO 390 
350       C3=C3+W: C4=C4+W 
360       IF C3>C1 AND C4 <= C2 THEN A$=LEFT$(A$,LEN(A$)-W) 
370       IF C3=C1 THEN A$=A$+"("
380       IF C4=C2 THEN A$=A$+") " 
390       NEXT K
400     H$=A$: PRINT H$: J=R: I=LS 
410     NEXT J 
420   NEXT I 
430 C1=Z: C2=Z
440 FOR I=2 TO LEN(S$)-W 
450   IF MID$(S$,I,W) = "<" THEN C1=C1+W 
460   IF MIDS(S$,I,W) = ">" THEN C2=C2+W 
470   NEXT I
480 IF C1=W AND C2=W AND LEFTS(S$,2)=" <" AND RIGHTS(S$,2)="> " THEN PRINT: PRINT "Parsing complete.": END 
490 IF F=W THEN GOTO 170 
500 REM -- Back up the parse tree: 
505 
510 PRINT â€œBacking up ...."
520 IF C=Z THEN PRINT "I cannot parse this -- sorry!": STOP
530 Q=LA%(C): S=R%(C)+W
540 C1=Z: C2=Z: S1$=LEFTS(S$,Q): S2$=RIGHTS(S$,LB%(C)) 
550 FOR K=W TO Q 
560   IF MID$(S1$,K,W)=" " THEN C1=C1+W 
570   NEXT K: SP=C1
580 FOR K=W TO LEN(H$)
590   IF MID$(H$,K,W)=" " THEN C2=C2+W 
600   IF C1=C2 THEN C1=K: K=LEN(H$) 
610   NEXT K
620 H$=LEFT$(H$,C1)+RIGHT$(H$,LEN(H$)-W-C1): C2=Z: A$=LEFT$(H$,C1): F=Z
630 FOR K=C1+W TO LEN(H$): M$=MID$(H$,K,W): IF M$<>"(" AND M$<>")" THEN GOTO 710 
640   IF M$="(" THEN C2=C2+W
650   IF M$=")" THEN C2=C2-W 
660   IF C2 <> -W THEN 700
670   C2=999 
680   IF F=W THEN K=K+W: F=Z 
690   GOTO 720 
700   IF C2=Z THEN A$=A$+M$+" ": F=W: GOTO 720 
710   A$=A$+M$
720   NEXT K
730 IF RIGHT$(A$,W) = * " THEN A$=LEFT$(A$,LEN(A$)-W): GOTO 730 
735 REM Deletes trailing spaces. 
740 H$=A$+" "
750 S$=S1$ + W$(R%(C))+S2$
760 C=C-W 
770 PRINT C;" ";S$: PRINT H$
780 C1=SP-W: LS=LEN(S$): GOTO 200 
790 REM -- The End:
800 END 
999 :
1000 REM Rules of grammar: 
1001 REM Note that no spaces are allowed except where shown: 
1010 DATA <SENTENCE>=<NOUN.PHRASE> <VERB.PHRASE-PREPOSITIONAL.PHRASES> 
1020 DATA <SENTENCE>=<SENTENCE> <CONJUNCTION> <SENTENCE> 
1030 DATA <NOUN.PHRASE>=<DETERMINER> <ADJECTIVES-NOUN> 
1040 DATA <ADJECTIVES-NOUN>=<ADJECTIVE> <ADJECTIVES-NOUN> 
1050 DATA <ADJECTIVES-NOUN>=<NOUN> 
1060 DATA <VERB.PHRASE-PREPOSITIONAL.PHRASES>=<VERB.PHRASE-PREPOSITIONAL.PHRASES> <PREPOSITIONAL.PHRASE>
1070 DATA <VERB.PHRASE-PREPOSITIONAL.PHRASES>=<VERB.PHRASE> 
1080 DATA <VERB.PHRASE>=<VERB> <NOUN.PHRASE> 
1090 DATA <VERB.PHRASE-PREPOSITIONAL.PHRASES>=<VERB> <PREPOSITIONAL.PHRASE> 
1100 DATA <PREPOSITIONAL.PHRASE>=<PREPOSITION> <NOUN.PHRASE> 
1110 DATA <VERB.PHRASE>=<VERB> 
1120 DATA <DETERMINER>=A,THE,THIS,THAT 
1130 DATA <ADJECTIVE>=GREEN,RED,STRONG 
1140 DATA <NOUN>=ROSE,GRASS,SUN 
1150 DATA <VERB>=GREW,SHONE 
1160 DATA <PREPOSITION>=TO,OF 
1170 DATA <CONJUNCTION>=AND 
1180 DATA 999 
1190 REM 999 is stop code. 